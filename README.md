alembicでmigration
  docker-compose exec fastapi sh
  alembic init migration
  ＃　以下が追加される
    appフォルダ
    ├── alembic.ini
    └── migration
        ├── versions
        ├── env.py
        ├── README
        └── script.py.mako

dbの接続先を変更する
  touch .env
  ```
  DATABASE_URL=postgresql://postgres:password@postgres-db:5432/postgres
  ```

core/config.pyの作成
  mkdir core
  touch config.py
  ```
  import os
  from functools import lru_cache
  from pydantic import BaseSettings
  
  PROJECT_ROOT = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
  
  class Environment(BaseSettings):
      """ 環境変数を読み込む
      """
      database_url: str
  
      class Config:
          env_file = os.path.join(PROJECT_ROOT, '.env')
  
  @lru_cache
  def get_env():
      """ @lru_cacheで.envの結果をキャッシュする
      """
      return Environment()
  ```

alembic revision -m "create users table"
# migration/version/配下にmigrationファイルが生成される。

# migrationファイルの変更
```
def upgrade():
    op.create_table(
        'users',
        sa.Column('id', sa.Integer, primary_key=True),
        sa.Column('name', sa.String(50), nullable=False),
        sa.Column('login_id', sa.String(50), nullable=False),
        sa.Column('password', sa.Text(), nullable=False),
    )
```
alembic upgrade head

# models.pyを作成
touch migration/models.py
```
from datetime import datetime

from sqlalchemy import create_engine, Column, String, Integer, Text, DateTime
from sqlalchemy.ext.declarative import declarative_base
from core.config import get_env

# Engine の作成
Engine = create_engine(
    get_env().database_url,
    encoding="utf-8",
    echo=False
)

BaseModel = declarative_base()

class User(BaseModel):
    __tablename__ = 'users'

    id = Column(Integer, primary_key=True)
    name = Column(String(50), nullable=False)
    login_id = Column(String(50), unique=True, nullable=False)
    password = Column(Text, nullable=False)
    created_at = Column(DateTime, default=datetime.now, nullable=False) # 追加分
    updated_at = Column(DateTime, default=datetime.now, nullable=False) # 追加分
```

# migrationファイルの生成
alembic revision --autogenerate -m "add columns"
```
"""add columns

Revision ID: xxxxxxx
Revises: yyyyyyyyy
Create Date: YYYY-MM-dd HH:mm:ss.ssssss+09:00

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = 'xxxxxxx'
down_revision = 'yyyyyyyyy'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('users', sa.Column('created_at', sa.DateTime(), nullable=False))
    op.add_column('users', sa.Column('updated_at', sa.DateTime(), nullable=False))
    op.create_unique_constraint(None, 'users', ['login_id'])
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, 'users', type_='unique')
    op.drop_column('users', 'updated_at')
    op.drop_column('users', 'created_at')
    # ### end Alembic commands ###
```

# migrationの実行
alembic upgrade head

# baseに戻す
alembic downgrade base
